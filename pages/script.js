(()=>{var c=3*16384,m={[0]:c+18492,[1]:c+18780},d=8,a=256,p=2,b=16384,y=32767,A=70;function g(e){let n=Array.from(new Uint8Array(e.slice(308,323))).filter(t=>t!==0).map(t=>String.fromCharCode(t)).join("");switch(n){case"ZELDA DINAZ7E":return 0;case"ZELDA NAYRUAZ8E":return 1}return new Error("Unrecognized ROM title: "+n)}function M(e,n){return e.getInt16(n,!0)}function i(e,n,t){return t.indexOf(e)===n}function E(e){return e>=b&&e<=y-a}function T(e){let n=e.slice(0);for(let t=n.length-1;t>0;t--){let r=Math.floor(Math.random()*(t+1));[n[t],n[r]]=[n[r],n[t]]}return n}function h(e,n){return[...Array(d).keys()].map(t=>M(e,m[n]+t*p)).filter(i)}function w(e,n){return n.flatMap(t=>{let r=c+t,o=e.slice(r,r+a);return Array.from(new Uint8Array(o))}).filter(i)}function x(e){let n=T(e);return new Map(e.map((t,r)=>[t,n[r]]))}function S(e,n,t){for(let r of n)for(let o=0;o<a;o++){let s=c+r+o;e.setUint8(s,t.get(e.getUint8(s)))}}function f(e){let n=g(e);if(n instanceof Error)return n;let t=new DataView(e),r=h(t,n),o=w(e,r);if(!r.every(E)||o.some(l=>l>A))return new Error("Could not read music table");let s=x(o);console.log(s),S(t,r,s)}var U=document.querySelector("#generateButton"),u=document.querySelector("#messageArea");function B(e){u.setAttribute("style","display: block;"),u.innerText=e.message+"."}function L(){u.setAttribute("style","display: none;")}function I(e,n){let t=URL.createObjectURL(e),r=document.createElement("a");r.setAttribute("style","display: none"),r.href=t,r.download=n,document.body.appendChild(r),r.click(),setTimeout(()=>{URL.revokeObjectURL(t),document.body.removeChild(r)})}U.addEventListener("click",e=>{let t=document.querySelector("#fileInput").files?.item(0);t&&t.arrayBuffer().then(r=>{let o=f(r);if(o)B(o);else{L();let s=new Blob([r],{type:"application/gbc"});I(s,t.name.replace(".gbc","_extras.gbc"))}})});})();
