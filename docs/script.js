(()=>{function a(e,n,t){return t.indexOf(e)===n}var E=32767,S=16384,d=334,U=2,u=256,f=8,m=2;function l(e){let n=Array.from(new Uint8Array(e.slice(308,323))).filter(t=>t!==0).map(t=>String.fromCharCode(t)).join("");switch(n){case"ZELDA DINAZ7E":return 0;case"ZELDA NAYRUAZ8E":return 1}throw new Error("Unrecognized ROM title: "+n)}function O(e){return e>=S&&e<=E}function b(e,n,t=!0){let r=e.getUint16(n,t);if(!O(r))throw new Error("Read invalid pointer from ROM");return r}function i(e,n,t){return[...Array(t).keys()].map(o=>b(e,n+o*m)).filter(a)}function y(e){let n=0;for(let t of e)n=(n+t)%65536;return n}function w(e){let n=new Uint8Array(e),t=(y(n.slice(0,d))+y(n.slice(d+U)))%65536;new DataView(e).setUint16(d,t,!1)}var p=3*16384,V={[0]:18492,[1]:18780},B=70;function I(e){let n=e.slice(0);for(let t=n.length-1;t>0;t--){let r=Math.floor(Math.random()*(t+1));[n[t],n[r]]=[n[r],n[t]]}return n}function R(e,n){return n.flatMap(t=>{let r=p+t,o=e.slice(r,r+u);return Array.from(new Uint8Array(o))}).filter(a)}function L(e){let n=I(e);return new Map(e.map((t,r)=>[t,n[r]]))}function P(e,n,t){for(let r of n)for(let o=0;o<u;o++){let c=p+r+o;e.setUint8(c,t.get(e.getUint8(c)))}}function g(e){let n=l(e),t=new DataView(e),r=p+V[n],o=i(t,r,f),c=R(e,o);if(c.some(k=>k>B))throw new Error("Read invalid music index from ROM");let s=L(c);P(t,o,s)}var z={[0]:16*16384,[1]:20*16384},C={[0]:23355,[1]:17195},v={[0]:16*16384,[1]:17*16384},j=[8,9,10,12,13,16,18,19,20,21,22,23,24,25,26,28,30,32,33,34,35,37,38,41,45,48,49,50,57,58,60,61,62,64,67,69,72,73,74,75,76,77,78,79,85];function q(e,n){let t=z[n],r=t+C[n];return i(e,r,f).filter(a).flatMap(o=>i(e,t+o,u)).filter(a)}function H(e){return e===255||e===254}function x(e,n,t){for(;e.getUint8(n)<240;)n+=t;return n}function A(e,n,t){let r=[];for(;e.getUint8(n)<240;)r.push(n),n+=t;return[n,r]}function G(e,n,t){let r=e.getUint8(t);switch(t++,r){case 240:return[t+1,[]];case 241:return[x(e,t+1,2),[]];case 242:return[x(e,t,4),[]];case 243:case 244:case 245:let o;try{o=b(e,t,!0)}catch{return[t+m,[]]}return[t+m,T(e,n,o)];case 246:return A(e,t+1,2);case 247:return A(e,t+1,4);case 248:return[x(e,t,3),[]];case 249:return[x(e,t,6),[]];case 250:return[x(e,t+1,2),[]];default:throw new Error("Read invalid object from ROM")}}function T(e,n,t){let r=[],o=n+t;for(;!H(e.getUint8(o));){let[c,s]=G(e,n,o);o=c,r.push(...s)}return r.filter(a)}function F(e){return e[Math.floor(Math.random()*e.length)]}function M(e){let n=l(e),t=new DataView(e),r=v[n],o=q(t,n).flatMap(s=>T(t,r,s)).filter(a).filter(s=>j.includes(t.getUint8(s))),c=o.map(s=>t.getUint16(s));for(let s of o)t.setUint16(s,F(c))}var Z=document.querySelector("#generateButton"),h=document.querySelector("#messageArea"),N=document.querySelector("#musicShuffleCheckbox"),Y=document.querySelector("#enemizerCheckbox");function _(e){h.setAttribute("style","display: block;"),h.innerText=e.message+"."}function J(){h.setAttribute("style","display: none;")}function K(e,n){let t=URL.createObjectURL(e),r=document.createElement("a");r.setAttribute("style","display: none"),r.href=t,r.download=n,document.body.appendChild(r),r.click(),setTimeout(()=>{URL.revokeObjectURL(t),document.body.removeChild(r)})}Z.addEventListener("click",e=>{let t=document.querySelector("#fileInput").files?.item(0);t&&t.arrayBuffer().then(r=>{J();try{N.checked&&g(r),Y.checked&&M(r),w(r);let o=new Blob([r],{type:"application/gbc"});K(o,t.name.replace(".gbc","_extras.gbc"))}catch(o){_(o)}})});})();
