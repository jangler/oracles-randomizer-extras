(()=>{function s(e,t,n){return n.indexOf(e)===t}var O=32767,M=16384,f=334,D=2,h=256,y=8,i=2;function u(e){let t=Array.from(new Uint8Array(e.slice(308,323))).filter(n=>n!==0).map(n=>String.fromCharCode(n)).join("");switch(t){case"ZELDA DINAZ7E":return 0;case"ZELDA NAYRUAZ8E":return 1}throw new Error("Unrecognized ROM title: "+t)}function P(e){return e>=M&&e<=O}function d(e){return Math.floor(e/16384).toString(16)+":"+(16384+e%16384).toString(16)}function m(e,t,n=!0){let r=e.getUint16(t,n);if(!P(r))throw new Error("Read invalid pointer from ROM at "+d(t));return r}function l(e,t,n){return[...Array(n).keys()].map(x=>m(e,t+x*i)).filter(s)}function g(e){let t=0;for(let n of e)t=(t+n)%65536;return t}function w(e){let t=new Uint8Array(e),n=(g(t.slice(0,f))+g(t.slice(f+D)))%65536;new DataView(e).setUint16(f,n,!1)}var L={[0]:(57-1)*16384+22479,[1]:(57-1)*16384+22344},A=3,S=!0,V=[0,55,58,59,65,66,67,68,69,71,72,73,75],R=[6,16,64],b={[0]:[61],[1]:[36,48]},z=[...new Array(76).keys()].filter(e=>![V,R,b[0],b[1]].some(t=>t.includes(e)));function C(e,t){let n=e.getUint8(t),r=e.getUint16(t+1,S);if(n>63||r<16384||r>32767){let x="Read invalid sound pointer at "+d(t);throw new Error(x)}return[n,r]}function j(e,t,n){e.setUint8(t,n[0]),e.setUint16(t+1,n[1],S)}function v(e){let t=e.slice(0);for(let n=t.length-1;n>0;n--){let r=Math.floor(Math.random()*(n+1));[t[n],t[r]]=[t[r],t[n]]}return t}function E(e){let t=u(e),n=new DataView(e),r=L[t],x=z.concat(b[t]),c=x.map(o=>C(n,r+o*A));v(c).forEach((o,I)=>j(n,r+x[I]*A,o))}var H={[0]:16*16384,[1]:20*16384},q={[0]:23355,[1]:17195},G={[0]:16*16384,[1]:17*16384},Z=[8,9,10,12,13,16,18,19,20,21,22,23,24,25,26,28,30,32,33,34,35,37,38,41,45,48,49,50,57,58,60,61,62,64,67,69,72,73,74,75,76,77,78,79,85];function F(e,t){let n=H[t],r=n+q[t];return l(e,r,y).filter(s).flatMap(x=>l(e,n+x,h)).filter(s)}function N(e){return e===255||e===254}function a(e,t,n){for(;e.getUint8(t)<240;)t+=n;return t}function k(e,t,n){let r=[];for(;e.getUint8(t)<240;)r.push(t),t+=n;return[t,r]}function Y(e,t,n){let r=e.getUint8(n);switch(n++,r){case 240:return[n+1,[]];case 241:return[a(e,n+1,2),[]];case 242:return[a(e,n,4),[]];case 243:case 244:case 245:let x;try{x=m(e,n,!0)}catch{return[n+i,[]]}return[n+i,T(e,t,x)];case 246:return k(e,n+1,2);case 247:return k(e,n+1,4);case 248:return[a(e,n,3),[]];case 249:return[a(e,n,6),[]];case 250:return[a(e,n+1,2),[]];default:throw new Error("Read invalid object from ROM")}}function T(e,t,n){let r=[],x=t+n;for(;!N(e.getUint8(x));){let[c,o]=Y(e,t,x);x=c,r.push(...o)}return r.filter(s)}function _(e){return e[Math.floor(Math.random()*e.length)]}function U(e){let t=u(e),n=new DataView(e),r=G[t],x=F(n,t).flatMap(o=>T(n,r,o)).filter(s).filter(o=>Z.includes(n.getUint8(o))),c=x.map(o=>n.getUint16(o));for(let o of x)n.setUint16(o,_(c))}var J=document.querySelector("#generateButton"),p=document.querySelector("#messageArea"),K=document.querySelector("#musicShuffleCheckbox"),Q=document.querySelector("#enemizerCheckbox");function W(e){p.setAttribute("style","display: block;"),p.innerText=e.message+"."}function X(){p.setAttribute("style","display: none;")}function $(e,t){let n=URL.createObjectURL(e),r=document.createElement("a");r.setAttribute("style","display: none"),r.href=n,r.download=t,document.body.appendChild(r),r.click(),setTimeout(()=>{URL.revokeObjectURL(n),document.body.removeChild(r)})}J.addEventListener("click",e=>{let n=document.querySelector("#fileInput").files?.item(0);n&&n.arrayBuffer().then(r=>{X();try{K.checked&&E(r),Q.checked&&U(r),w(r);let x=new Blob([r],{type:"application/gbc"});$(x,n.name.replace(".gbc","_extras.gbc"))}catch(x){W(x)}})});})();
