(()=>{function c(e,n,t){return t.indexOf(e)===n}var O=32767,D=16384,f=334,M=2,h=256,g=8,i=2;function u(e){let n=Array.from(new Uint8Array(e.slice(308,323))).filter(t=>t!==0).map(t=>String.fromCharCode(t)).join("");switch(n){case"ZELDA DINAZ7E":return 0;case"ZELDA NAYRUAZ8E":return 1}throw new Error("Unrecognized ROM title: "+n)}function I(e){return e>=D&&e<=O}function m(e){return Math.floor(e/16384).toString(16)+":"+(16384+e%16384).toString(16)}function d(e,n,t=!0){let r=e.getUint16(n,t);if(!I(r))throw new Error("Read invalid pointer from ROM at "+m(n));return r}function l(e,n,t){return[...Array(t).keys()].map(o=>d(e,n+o*i)).filter(c)}function p(e){let n=0;for(let t of e)n=(n+t)%65536;return n}function y(e){let n=new Uint8Array(e),t=(p(n.slice(0,f))+p(n.slice(f+M)))%65536;new DataView(e).setUint16(f,t,!1)}var B={[0]:(57-1)*16384+22479,[1]:(57-1)*16384+22344},w=3,S=!0,A=[...new Array(76).keys()];function L(e,n){let t=e.getUint8(n),r=e.getUint16(n+1,S);if(t>63||r<16384||r>32767){let o="Read invalid sound pointer at "+m(n);throw new Error(o)}return[t,r]}function V(e,n,t){e.setUint8(n,t[0]),e.setUint16(n+1,t[1],S)}function R(e){let n=e.slice(0);for(let t=n.length-1;t>0;t--){let r=Math.floor(Math.random()*(t+1));[n[t],n[r]]=[n[r],n[t]]}return n}function k(e){let n=u(e),t=new DataView(e),r=B[n],o=A.map(s=>L(t,r+s*w)),x=R(o);for(let s of A)V(t,r+s*w,x[s])}var z={[0]:16*16384,[1]:20*16384},C={[0]:23355,[1]:17195},j={[0]:16*16384,[1]:17*16384},v=[8,9,10,12,13,16,18,19,20,21,22,23,24,25,26,28,30,32,33,34,35,37,38,41,45,48,49,50,57,58,60,61,62,64,67,69,72,73,74,75,76,77,78,79,85];function H(e,n){let t=z[n],r=t+C[n];return l(e,r,g).filter(c).flatMap(o=>l(e,t+o,h)).filter(c)}function q(e){return e===255||e===254}function a(e,n,t){for(;e.getUint8(n)<240;)n+=t;return n}function E(e,n,t){let r=[];for(;e.getUint8(n)<240;)r.push(n),n+=t;return[n,r]}function G(e,n,t){let r=e.getUint8(t);switch(t++,r){case 240:return[t+1,[]];case 241:return[a(e,t+1,2),[]];case 242:return[a(e,t,4),[]];case 243:case 244:case 245:let o;try{o=d(e,t,!0)}catch{return[t+i,[]]}return[t+i,T(e,n,o)];case 246:return E(e,t+1,2);case 247:return E(e,t+1,4);case 248:return[a(e,t,3),[]];case 249:return[a(e,t,6),[]];case 250:return[a(e,t+1,2),[]];default:throw new Error("Read invalid object from ROM")}}function T(e,n,t){let r=[],o=n+t;for(;!q(e.getUint8(o));){let[x,s]=G(e,n,o);o=x,r.push(...s)}return r.filter(c)}function Z(e){return e[Math.floor(Math.random()*e.length)]}function U(e){let n=u(e),t=new DataView(e),r=j[n],o=H(t,n).flatMap(s=>T(t,r,s)).filter(c).filter(s=>v.includes(t.getUint8(s))),x=o.map(s=>t.getUint16(s));for(let s of o)t.setUint16(s,Z(x))}var F=document.querySelector("#generateButton"),b=document.querySelector("#messageArea"),N=document.querySelector("#musicShuffleCheckbox"),Y=document.querySelector("#enemizerCheckbox");function _(e){b.setAttribute("style","display: block;"),b.innerText=e.message+"."}function J(){b.setAttribute("style","display: none;")}function K(e,n){let t=URL.createObjectURL(e),r=document.createElement("a");r.setAttribute("style","display: none"),r.href=t,r.download=n,document.body.appendChild(r),r.click(),setTimeout(()=>{URL.revokeObjectURL(t),document.body.removeChild(r)})}F.addEventListener("click",e=>{let t=document.querySelector("#fileInput").files?.item(0);t&&t.arrayBuffer().then(r=>{J();try{N.checked&&k(r),Y.checked&&U(r),y(r);let o=new Blob([r],{type:"application/gbc"});K(o,t.name.replace(".gbc","_extras.gbc"))}catch(o){_(o)}})});})();
