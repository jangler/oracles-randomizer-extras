(()=>{var a=334,T=2;function s(e){let t=Array.from(new Uint8Array(e.slice(308,323))).filter(n=>n!==0).map(n=>String.fromCharCode(n)).join("");switch(t){case"ZELDA DINAZ7E":return 0;case"ZELDA NAYRUAZ8E":return 1}throw new Error("Unrecognized ROM title: "+t)}function x(e){return Math.floor(e/16384).toString(16)+":"+(16384+e%16384).toString(16)}function d(e){let t=0;for(let n of e)t=(t+n)%65536;return t}function b(e){let t=new Uint8Array(e),n=(d(t.slice(0,a))+d(t.slice(a+T)))%65536;new DataView(e).setUint16(a,n,!1)}var I={[0]:(57-1)*16384+22479,[1]:(57-1)*16384+22344},g=3,h=!0,p=[0,55,58,59,65,66,67,68,69,71,72,73,75,151],L=[6,16,64],i={[0]:[61],[1]:[36,48]},M=[...new Array(76).keys()].filter(e=>![p,L,i[0],i[1]].some(t=>t.includes(e))),u={[0]:[],[1]:[161,173,182,212]},U=[185,194],B=[...new Array(213).keys()].filter(e=>e>=76&&![p,U,u[0],u[1]].some(t=>t.includes(e)));function C(e,t){let n=e.getUint8(t),r=e.getUint16(t+1,h);if(n>63||r<16384||r>32767){let o="Read invalid sound pointer at "+x(t);throw new Error(o)}return[n,r]}function H(e,t,n){e.setUint8(t,n[0]),e.setUint16(t+1,n[1],h)}function O(e){let t=e.slice(0);for(let n=t.length-1;n>0;n--){let r=Math.floor(Math.random()*(n+1));[t[n],t[r]]=[t[r],t[n]]}return t}function y(e,t){let n=new DataView(e),r=s(e),o=I[r],E=t.map(c=>C(n,o+c*g));O(E).forEach((c,k)=>H(n,o+t[k]*g,c))}function S(e){let t=s(e);y(e,M.concat(i[t]))}function A(e){let t=s(e);y(e,B.concat(u[t]))}var D=document.querySelector("#generateButton"),m=document.querySelector("#messageArea"),P=document.querySelector("#musicShuffleCheckbox"),R=document.querySelector("#sfxShuffleCheckbox"),f=document.querySelector("#changelogButton"),w=document.querySelector("#changelog"),l=!1;function q(e){m.setAttribute("style","display: block;"),m.innerText=e.message+"."}function v(){m.setAttribute("style","display: none;")}function V(e,t){let n=URL.createObjectURL(e),r=document.createElement("a");r.setAttribute("style","display: none"),r.href=n,r.download=t,document.body.appendChild(r),r.click(),setTimeout(()=>{URL.revokeObjectURL(n),document.body.removeChild(r)})}D.addEventListener("click",e=>{let n=document.querySelector("#fileInput").files?.item(0);n&&n.arrayBuffer().then(r=>{v();try{P.checked&&S(r),R.checked&&A(r),b(r);let o=new Blob([r],{type:"application/gbc"});V(o,n.name.replace(".gbc","_extras.gbc"))}catch(o){q(o)}})});f.addEventListener("click",e=>{l?(w.setAttribute("style","display: none"),f.textContent="Show changelog"):(w.setAttribute("style","display: block"),f.textContent="Hide changelog"),l=!l});})();
