(()=>{var u=334,h=2;function l(e){let t=Array.from(new Uint8Array(e.slice(308,323))).filter(n=>n!==0).map(n=>String.fromCharCode(n)).join("");switch(t){case"ZELDA DINAZ7E":return 0;case"ZELDA NAYRUAZ8E":return 1}throw new Error("Unrecognized ROM title: "+t)}function m(e,t){return e.getInt16(t,!0)}function f(e){let t=0;for(let n of e)t=(t+n)%65536;return t}function d(e){let t=new Uint8Array(e),n=(f(t.slice(0,u))+f(t.slice(u+h)))%65536;new DataView(e).setUint16(u,n,!1)}var s=3*16384,A={[0]:s+18492,[1]:s+18780},x=8,a=256,g=2,M=16384,w=32767,T=70;function p(e,t,n){return n.indexOf(e)===t}function E(e){return e>=M&&e<=w-a}function k(e){let t=e.slice(0);for(let n=t.length-1;n>0;n--){let r=Math.floor(Math.random()*(n+1));[t[n],t[r]]=[t[r],t[n]]}return t}function S(e,t){return[...Array(x).keys()].map(n=>m(e,A[t]+n*g)).filter(p)}function U(e,t){return t.flatMap(n=>{let r=s+n,o=e.slice(r,r+a);return Array.from(new Uint8Array(o))}).filter(p)}function B(e){let t=k(e);return new Map(e.map((n,r)=>[n,t[r]]))}function L(e,t,n){for(let r of t)for(let o=0;o<a;o++){let c=s+r+o;e.setUint8(c,n.get(e.getUint8(c)))}}function b(e){let t=l(e),n=new DataView(e),r=S(n,t),o=U(e,r);if(!r.every(E)||o.some(y=>y>T))throw new Error("Could not read music table");let c=B(o);L(n,r,c)}var C=document.querySelector("#generateButton"),i=document.querySelector("#messageArea"),I=document.querySelector("#musicShuffleCheckbox"),V=document.querySelector("#enemizerCheckbox");function P(e){i.setAttribute("style","display: block;"),i.innerText=e.message+"."}function z(){i.setAttribute("style","display: none;")}function D(e,t){let n=URL.createObjectURL(e),r=document.createElement("a");r.setAttribute("style","display: none"),r.href=n,r.download=t,document.body.appendChild(r),r.click(),setTimeout(()=>{URL.revokeObjectURL(n),document.body.removeChild(r)})}C.addEventListener("click",e=>{let n=document.querySelector("#fileInput").files?.item(0);n&&n.arrayBuffer().then(r=>{z();try{I.checked&&b(r),V.checked&&void 0,d(r);let o=new Blob([r],{type:"application/gbc"});D(o,n.name.replace(".gbc","_extras.gbc"))}catch(o){P(o)}})});})();
