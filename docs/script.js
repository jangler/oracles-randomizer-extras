(()=>{var c=3*16384,p={[0]:c+18492,[1]:c+18780},b=8,a=256,y=2,u=334,A=2,g=16384,x=32767,M=70;function h(e){let t=Array.from(new Uint8Array(e.slice(308,323))).filter(n=>n!==0).map(n=>String.fromCharCode(n)).join("");switch(t){case"ZELDA DINAZ7E":return 0;case"ZELDA NAYRUAZ8E":return 1}return new Error("Unrecognized ROM title: "+t)}function w(e,t){return e.getInt16(t,!0)}function l(e,t,n){return n.indexOf(e)===t}function E(e){return e>=g&&e<=x-a}function T(e){let t=e.slice(0);for(let n=t.length-1;n>0;n--){let r=Math.floor(Math.random()*(n+1));[t[n],t[r]]=[t[r],t[n]]}return t}function U(e,t){return[...Array(b).keys()].map(n=>w(e,p[t]+n*y)).filter(l)}function S(e,t){return t.flatMap(n=>{let r=c+n,o=e.slice(r,r+a);return Array.from(new Uint8Array(o))}).filter(l)}function k(e){let t=T(e);return new Map(e.map((n,r)=>[n,t[r]]))}function B(e,t,n){for(let r of t)for(let o=0;o<a;o++){let s=c+r+o;e.setUint8(s,n.get(e.getUint8(s)))}}function f(e){let t=0;for(let n of e)t=(t+n)%65536;return t}function L(e){let t=new Uint8Array(e),n=(f(t.slice(0,u))+f(t.slice(u+A)))%65536;new DataView(e).setUint16(u,n,!1)}function m(e){let t=h(e);if(t instanceof Error)return t;let n=new DataView(e),r=U(n,t),o=S(e,r);if(!r.every(E)||o.some(d=>d>M))return new Error("Could not read music table");let s=k(o);B(n,r,s),L(e)}var V=document.querySelector("#generateButton"),i=document.querySelector("#messageArea");function I(e){i.setAttribute("style","display: block;"),i.innerText=e.message+"."}function D(){i.setAttribute("style","display: none;")}function P(e,t){let n=URL.createObjectURL(e),r=document.createElement("a");r.setAttribute("style","display: none"),r.href=n,r.download=t,document.body.appendChild(r),r.click(),setTimeout(()=>{URL.revokeObjectURL(n),document.body.removeChild(r)})}V.addEventListener("click",e=>{let n=document.querySelector("#fileInput").files?.item(0);n&&n.arrayBuffer().then(r=>{let o=m(r);if(o)I(o);else{D();let s=new Blob([r],{type:"application/gbc"});P(s,n.name.replace(".gbc","_extras.gbc"))}})});})();
