(()=>{function c(e,n,t){return t.indexOf(e)===n}var E=32767,S=16384,b=334,U=2,a=256,f=8,m=2;function l(e){let n=Array.from(new Uint8Array(e.slice(308,323))).filter(t=>t!==0).map(t=>String.fromCharCode(t)).join("");switch(n){case"ZELDA DINAZ7E":return 0;case"ZELDA NAYRUAZ8E":return 1}throw new Error("Unrecognized ROM title: "+n)}function O(e){return e>=S&&e<=E}function p(e,n,t=!0){let r=e.getUint16(n,t);if(!O(r))throw new Error("Read invalid pointer from ROM");return r}function u(e,n,t){return[...Array(t).keys()].map(s=>p(e,n+s*m)).filter(c)}function y(e){let n=0;for(let t of e)n=(n+t)%65536;return n}function w(e){let n=new Uint8Array(e),t=(y(n.slice(0,b))+y(n.slice(b+U)))%65536;new DataView(e).setUint16(b,t,!1)}var x=3*16384,V={[0]:18492,[1]:18780},D=70;function I(e){let n=e.slice(0);for(let t=n.length-1;t>0;t--){let r=Math.floor(Math.random()*(t+1));[n[t],n[r]]=[n[r],n[t]]}return n}function R(e,n){return n.flatMap(t=>{let r=x+t,s=e.slice(r,r+a);return Array.from(new Uint8Array(s))}).filter(c)}function L(e){let n=I(e);return new Map(e.map((t,r)=>[t,n[r]]))}function z(e,n,t){for(let r of n)for(let s=0;s<a;s++){let o=x+r+s;e.setUint8(o,t.get(e.getUint8(o)))}}function A(e){let n=l(e),t=new DataView(e),r=x+V[n],s=u(t,r,f),o=R(e,s);if(o.some(k=>k>D))throw new Error("Read invalid music index from ROM");let d=L(o);z(t,s,d)}var P={[0]:16*16384,[1]:20*16384},C={[0]:23355,[1]:17195},v={[0]:16*16384,[1]:17*16384};function j(e,n){let t=P[n],r=t+C[n];return u(e,r,f).filter(c).flatMap(s=>u(e,t+s,a)).filter(c)}function q(e){return e===255||e===254}function i(e,n,t){for(;e.getUint8(n)<240;)n+=t;return n}function g(e,n,t){let r=[];for(;e.getUint8(n)<240;)r.push(n),n+=t;return[n,r]}function H(e,n,t){let r=e.getUint8(t);switch(t++,r){case 240:return[t+1,[]];case 241:return[i(e,t+1,2),[]];case 242:return[i(e,t,4),[]];case 243:case 244:case 245:let s;try{s=p(e,t,!0)}catch{return[t+m,[]]}return[t+m,M(e,n,s)];case 246:return g(e,t+1,2);case 247:return g(e,t+1,4);case 248:return[i(e,t,3),[]];case 249:return[i(e,t,6),[]];case 250:return[i(e,t+1,2),[]];default:throw new Error("Read invalid object from ROM")}}function M(e,n,t){let r=[],s=n+t;for(;!q(e.getUint8(s));){let[o,d]=H(e,n,s);s=o,r.push(...d)}return r.filter(c)}function T(e){let n=l(e),t=new DataView(e),r=v[n],s=j(t,n).flatMap(o=>M(t,r,o)).filter(c)}var G=document.querySelector("#generateButton"),h=document.querySelector("#messageArea"),F=document.querySelector("#musicShuffleCheckbox"),Z=document.querySelector("#enemizerCheckbox");function N(e){h.setAttribute("style","display: block;"),h.innerText=e.message+"."}function Y(){h.setAttribute("style","display: none;")}function _(e,n){let t=URL.createObjectURL(e),r=document.createElement("a");r.setAttribute("style","display: none"),r.href=t,r.download=n,document.body.appendChild(r),r.click(),setTimeout(()=>{URL.revokeObjectURL(t),document.body.removeChild(r)})}G.addEventListener("click",e=>{let t=document.querySelector("#fileInput").files?.item(0);t&&t.arrayBuffer().then(r=>{Y();try{F.checked&&A(r),Z.checked&&T(r),w(r);let s=new Blob([r],{type:"application/gbc"});_(s,t.name.replace(".gbc","_extras.gbc"))}catch(s){N(s)}})});})();
