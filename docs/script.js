(()=>{var i=334,w=2;function s(t){let e=Array.from(new Uint8Array(t.slice(308,323))).filter(n=>n!==0).map(n=>String.fromCharCode(n)).join("");switch(e){case"ZELDA DINAZ7E":return 0;case"ZELDA NAYRUAZ8E":return 1}throw new Error("Unrecognized ROM title: "+e)}function m(t){return Math.floor(t/16384).toString(16)+":"+(16384+t%16384).toString(16)}function l(t){let e=0;for(let n of t)e=(e+n)%65536;return e}function x(t){let e=new Uint8Array(t),n=(l(e.slice(0,i))+l(e.slice(i+w)))%65536;new DataView(t).setUint16(i,n,!1)}var k={[0]:(57-1)*16384+22479,[1]:(57-1)*16384+22344},d=3,b=!0,p=[0,55,58,59,65,66,67,68,69,71,72,73,75,151],E=[6,16,64],a={[0]:[61],[1]:[36,48]},I=[...new Array(76).keys()].filter(t=>![p,E,a[0],a[1]].some(e=>e.includes(t))),u={[0]:[],[1]:[161,173,182,212]},T=[185,194],U=[...new Array(213).keys()].filter(t=>t>=76&&![p,T,u[0],u[1]].some(e=>e.includes(t)));function M(t,e){let n=t.getUint8(e),r=t.getUint16(e+1,b);if(n>63||r<16384||r>32767){let o="Read invalid sound pointer at "+m(e);throw new Error(o)}return[n,r]}function L(t,e,n){t.setUint8(e,n[0]),t.setUint16(e+1,n[1],b)}function B(t){let e=t.slice(0);for(let n=e.length-1;n>0;n--){let r=Math.floor(Math.random()*(n+1));[e[n],e[r]]=[e[r],e[n]]}return e}function g(t,e){console.log(e);let n=new DataView(t),r=s(t),o=k[r],S=e.map(c=>M(n,o+c*d));B(S).forEach((c,A)=>L(n,o+e[A]*d,c))}function h(t){let e=s(t);g(t,I.concat(a[e]))}function y(t){let e=s(t);g(t,U.concat(u[e]))}var C=document.querySelector("#generateButton"),f=document.querySelector("#messageArea"),O=document.querySelector("#musicShuffleCheckbox"),D=document.querySelector("#sfxShuffleCheckbox");function P(t){f.setAttribute("style","display: block;"),f.innerText=t.message+"."}function R(){f.setAttribute("style","display: none;")}function H(t,e){let n=URL.createObjectURL(t),r=document.createElement("a");r.setAttribute("style","display: none"),r.href=n,r.download=e,document.body.appendChild(r),r.click(),setTimeout(()=>{URL.revokeObjectURL(n),document.body.removeChild(r)})}C.addEventListener("click",t=>{let n=document.querySelector("#fileInput").files?.item(0);n&&n.arrayBuffer().then(r=>{R();try{O.checked&&h(r),D.checked&&y(r),x(r);let o=new Blob([r],{type:"application/gbc"});H(o,n.name.replace(".gbc","_extras.gbc"))}catch(o){P(o)}})});})();
