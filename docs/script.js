(()=>{var u=334,A=2;function l(e){let t=Array.from(new Uint8Array(e.slice(308,323))).filter(n=>n!==0).map(n=>String.fromCharCode(n)).join("");switch(t){case"ZELDA DINAZ7E":return 0;case"ZELDA NAYRUAZ8E":return 1}throw new Error("Unrecognized ROM title: "+t)}function m(e,t){return e.getInt16(t,!0)}function f(e){let t=0;for(let n of e)t=(t+n)%65536;return t}function d(e){let t=new Uint8Array(e),n=(f(t.slice(0,u))+f(t.slice(u+A)))%65536;new DataView(e).setUint16(u,n,!1)}var c=3*16384,h={[0]:c+18492,[1]:c+18780},g=8,a=256,x=2,w=16384,M=32767,T=70;function p(e,t,n){return n.indexOf(e)===t}function E(e){return e>=w&&e<=M-a}function U(e){let t=e.slice(0);for(let n=t.length-1;n>0;n--){let r=Math.floor(Math.random()*(n+1));[t[n],t[r]]=[t[r],t[n]]}return t}function S(e,t){return[...Array(g).keys()].map(n=>m(e,h[t]+n*x)).filter(p)}function k(e,t){return t.flatMap(n=>{let r=c+n,o=e.slice(r,r+a);return Array.from(new Uint8Array(o))}).filter(p)}function B(e){let t=U(e);return new Map(e.map((n,r)=>[n,t[r]]))}function L(e,t,n){for(let r of t)for(let o=0;o<a;o++){let s=c+r+o;e.setUint8(s,n.get(e.getUint8(s)))}}function b(e){let t=l(e),n=new DataView(e),r=S(n,t),o=k(e,r);if(!r.every(E)||o.some(y=>y>T))throw new Error("Could not read music table");let s=B(o);L(n,r,s),d(e)}var V=document.querySelector("#generateButton"),i=document.querySelector("#messageArea");function I(e){i.setAttribute("style","display: block;"),i.innerText=e.message+"."}function P(){i.setAttribute("style","display: none;")}function D(e,t){let n=URL.createObjectURL(e),r=document.createElement("a");r.setAttribute("style","display: none"),r.href=n,r.download=t,document.body.appendChild(r),r.click(),setTimeout(()=>{URL.revokeObjectURL(n),document.body.removeChild(r)})}V.addEventListener("click",e=>{let n=document.querySelector("#fileInput").files?.item(0);n&&n.arrayBuffer().then(r=>{P();try{b(r);let o=new Blob([r],{type:"application/gbc"});D(o,n.name.replace(".gbc","_extras.gbc"))}catch(o){I(o)}})});})();
